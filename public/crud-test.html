<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD Test Suite</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 3px solid #ff8a3d;
        padding-bottom: 10px;
      }
      .test-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }
      .test-card {
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
      }
      .test-card h3 {
        margin-top: 0;
        color: #ff8a3d;
      }
      button {
        background: #ff8a3d;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        margin: 5px 5px 5px 0;
      }
      button:hover {
        background: #ff6b3d;
      }
      .result {
        background: #f0f0f0;
        border-left: 4px solid #ff8a3d;
        padding: 10px;
        margin-top: 10px;
        border-radius: 3px;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .success {
        border-left-color: #28a745;
        background: #f0fff4;
      }
      .error {
        border-left-color: #dc3545;
        background: #fff5f5;
      }
      .info {
        color: #666;
        font-size: 12px;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>‚úÖ CRUD Operation Test Suite</h1>
      <p>
        Test all CRUD operations to ensure no timestamp errors or other issues
      </p>

      <div class="test-grid">
        <!-- POLI -->
        <div class="test-card">
          <h3>üìã Poli Management</h3>
          <button onclick="testPoliRead()">GET (Load)</button>
          <button onclick="testPoliCreate()">POST (Create)</button>
          <button onclick="testPoliUpdate()">PUT (Update)</button>
          <button onclick="testPoliDelete()">DELETE</button>
          <div id="poli-result" class="result" style="display: none"></div>
        </div>

        <!-- SPESIALIS -->
        <div class="test-card">
          <h3>üè• Spesialis Management</h3>
          <button onclick="testSpesialisRead()">GET (Load)</button>
          <button onclick="testSpesialisCreate()">POST (Create)</button>
          <button onclick="testSpesialisUpdate()">PUT (Update)</button>
          <button onclick="testSpesialisDelete()">DELETE</button>
          <div id="spesialis-result" class="result" style="display: none"></div>
        </div>

        <!-- DOKTER -->
        <div class="test-card">
          <h3>üë®‚Äç‚öïÔ∏è Dokter Management</h3>
          <button onclick="testDokterRead()">GET (Load)</button>
          <button onclick="testDokterRead(1, true)">POST (Create)</button>
          <button onclick="testUpdate()">PUT (Update)</button>
          <button onclick="testDelete()">DELETE</button>
          <div id="dokter-result" class="result" style="display: none"></div>
        </div>

        <!-- JADWAL -->
        <div class="test-card">
          <h3>üìÖ Jadwal Management</h3>
          <button onclick="testJadwalRead()">GET (Load)</button>
          <button onclick="testJadwalCreate()">POST (Create)</button>
          <button onclick="testJadwalUpdate()">PUT (Update)</button>
          <button onclick="testJadwalDelete()">DELETE</button>
          <div id="jadwal-result" class="result" style="display: none"></div>
        </div>

        <!-- ARTIKEL -->
        <div class="test-card">
          <h3>üì∞ Artikel Management</h3>
          <button onclick="testArtikelRead()">GET (Load)</button>
          <button onclick="testArtikelCreate()">POST (Create)</button>
          <button onclick="testArtikelUpdate()">PUT (Update)</button>
          <button onclick="testArtikelDelete()">DELETE</button>
          <div id="artikel-result" class="result" style="display: none"></div>
        </div>

        <!-- ALL TESTS -->
        <div class="test-card">
          <h3>üß™ Batch Tests</h3>
          <button onclick="runAllTests()">Run All Tests</button>
          <div id="batch-result" class="result" style="display: none"></div>
        </div>
      </div>

      <div
        class="info"
        style="
          margin-top: 40px;
          padding: 15px;
          background: #fff8e1;
          border-radius: 5px;
        "
      >
        <strong>‚ÑπÔ∏è Important:</strong> Make sure you're logged in before running
        tests. If you see auth errors (401), log in first.
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:8080/api/admin";

      async function makeRequest(endpoint, method = "GET", body = null) {
        try {
          const options = {
            method: method,
            credentials: "include",
          };

          if (method !== "GET" && body) {
            options.headers = {
              "Content-Type": "application/x-www-form-urlencoded",
            };
            options.body = body;
          }

          const response = await fetch(`${API_URL}/${endpoint}`, options);
          const text = await response.text();

          try {
            return { status: response.status, data: JSON.parse(text) };
          } catch (e) {
            return {
              status: response.status,
              error: "Failed to parse JSON",
              responseText: text.substring(0, 200),
            };
          }
        } catch (error) {
          return { fetchError: error.message };
        }
      }

      function displayResult(elemId, result) {
        const elem = document.getElementById(elemId);
        elem.textContent = JSON.stringify(result, null, 2);
        elem.style.display = "block";

        if (
          result.error ||
          result.fetchError ||
          result.status === 401 ||
          result.status === 500
        ) {
          elem.className = "result error";
        } else if (result.data?.status === true) {
          elem.className = "result success";
        } else {
          elem.className = "result";
        }
      }

      async function testPoliRead() {
        const result = await makeRequest("poli");
        displayResult("poli-result", result);
      }

      async function testPoliCreate() {
        const params = new URLSearchParams();
        params.append("nama_poli", "Test Poli " + Date.now());
        params.append("deskripsi", "Test Description");
        const result = await makeRequest("poli", "POST", params.toString());
        displayResult("poli-result", result);
      }

      async function testSpesialisRead() {
        const result = await makeRequest("spesialis");
        displayResult("spesialis-result", result);
      }

      async function testSpesialisCreate() {
        const params = new URLSearchParams();
        params.append("nama_spesialis", "Test Spesialis " + Date.now());
        const result = await makeRequest(
          "spesialis",
          "POST",
          params.toString(),
        );
        displayResult("spesialis-result", result);
      }

      async function testJadwalRead() {
        const result = await makeRequest("jadwal");
        displayResult("jadwal-result", result);
      }

      async function testArtikelRead() {
        const result = await makeRequest("artikel?page=1");
        displayResult("artikel-result", result);
      }

      async function testDokterRead() {
        const result = await makeRequest("doctors?page=1");
        displayResult("dokter-result", result);
      }

      async function runAllTests() {
        const elem = document.getElementById("batch-result");
        elem.textContent = "‚è≥ Running all tests...";
        elem.style.display = "block";

        const results = {
          poli: await makeRequest("poli"),
          spesialis: await makeRequest("spesialis"),
          dokter: await makeRequest("doctors?page=1"),
          jadwal: await makeRequest("jadwal"),
          artikel: await makeRequest("artikel?page=1"),
        };

        displayResult("batch-result", results);
      }
    </script>
  </body>
</html>
